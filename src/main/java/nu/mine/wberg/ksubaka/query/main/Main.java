package nu.mine.wberg.ksubaka.query.main;import com.fasterxml.jackson.core.JsonProcessingException;import com.mashape.unirest.http.ObjectMapper;import com.mashape.unirest.http.Unirest;import nu.mine.wberg.ksubaka.query.moviesource.MovieData;import nu.mine.wberg.ksubaka.query.moviesource.MovieSource;import nu.mine.wberg.ksubaka.query.moviesource.MovieSourceFactory;import org.apache.http.impl.client.HttpClients;import java.io.IOException;import java.util.List;public class Main {    private static final int NAME_COLUMN_WIDTH = 60;    private static final int DIRECTOR_COLUMN_WIDTH = 30;    private static final int YEAR_COLUMN_WIDTH = 4;    public static void main(String... args) throws IOException {        configure();        MovieSourceFactory movieSourceFactory = new MovieSourceFactory();        List<MovieData> movieDatas;        try {            MovieSource movieSource = movieSourceFactory.getMovieSource(System.getProperty("api"));            movieDatas = movieSource.getMovieData(System.getProperty("movie"));        }        catch (RuntimeException e) {            System.err.println("" + e.getMessage());            return;        }        movieDatas.stream()                .sorted((m1, m2) -> Integer.compare(Integer.parseInt(m1.getYear()),                        Integer.parseInt(m2.getYear())))                .forEach(movieData ->                        System.out.printf("%-" + NAME_COLUMN_WIDTH + "s " +                                "%-" + DIRECTOR_COLUMN_WIDTH + "s " +                                "%-" + YEAR_COLUMN_WIDTH + "s " +                                "%n",                        movieData.getName(),                        movieData.getDirector(),                        movieData.getYear()));        Unirest.shutdown();    }    /**     * Sets up Unirest. I considered moving this to the constructor of the     * {@link MovieSourceFactory} but this should only be done once during the     * lifetime of the program, so I decided to keep it in a static context.     */    private static void configure() {        // set an object mapper to allow deserialisation of the JSON responses        Unirest.setObjectMapper(new ObjectMapper() {            private com.fasterxml.jackson.databind.ObjectMapper jacksonObjectMapper                    = new com.fasterxml.jackson.databind.ObjectMapper();            public <T> T readValue(String value, Class<T> valueType) {                try {                    return jacksonObjectMapper.readValue(value, valueType);                } catch (IOException e) {                    throw new RuntimeException(e);                }            }            public String writeValue(Object value) {                try {                    return jacksonObjectMapper.writeValueAsString(value);                } catch (JsonProcessingException e) {                    throw new RuntimeException(e);                }            }        });        // disable cookie management because IMDB cookies are invalid and it produces lots of error output        Unirest.setHttpClient(HttpClients.custom().disableCookieManagement().build());    }}